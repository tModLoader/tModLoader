<Project ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup>
		<!-- legacy property -->
		<TerrariaSteamPath>$(MSBuildThisFileDirectory)</TerrariaSteamPath>
		<tMLSteamPath>$(MSBuildThisFileDirectory)</tMLSteamPath>
		<tMLLibraryPath>$(tMLSteamPath)Libraries</tMLLibraryPath>
		<tMLAnalyzerPath>$(tMLSteamPath)Analyzers</tMLAnalyzerPath>
		<tMLName>tModLoader</tMLName>
		<tMLPath>$(tMLName).dll</tMLPath>
		<tMLServerPath>$(tMLPath) -server</tMLServerPath>
    	<DotNetName Condition=" '$(OS)' == 'Windows_NT' ">dotnet.exe</DotNetName>
    	<DotNetName Condition=" '$(OS)' == 'Unix' ">dotnet</DotNetName>
    	<DotNetName Condition=" '$(DotNetName)' == '' ">dotnet</DotNetName>
		<!-- TML stable version define placeholder -->
	</PropertyGroup>
	<ItemGroup>
		<AdditionalFiles Include="**/*.hjson" />
		<AdditionalFiles Include="**/*.txt" />
		<AdditionalFiles Include="**/*.png" />
		<AdditionalFiles Include="**/*.fx" />
		<!-- Remove the txt files that can be found in build folders, causing them to appear in the editor -->
		<AdditionalFiles Remove="bin/**" />
		<AdditionalFiles Remove="obj/**" />
		<Reference Include="$(tMLSteamPath)$(tMLPath)" />
		<Reference Include="$(tMLLibraryPath)/**/*.dll" />
		<Reference Remove="$(tMLLibraryPath)/Native/**" />
		<Reference Remove="$(tMLLibraryPath)/**/runtime*/**" />
		<Reference Remove="$(tMLLibraryPath)/**/*.resources.dll" />

		<PackageReference Include="Microsoft.CodeAnalysis.BannedApiAnalyzers" Version="3.3.4">
			<PrivateAssets>all</PrivateAssets>
			<IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
		</PackageReference>
	</ItemGroup>
	<ItemGroup>
		<Analyzer Include="$(tMLAnalyzerPath)/**/*.dll" />
		<AdditionalFiles Include="$(tMLSteamPath)BannedSymbols.txt" />
	</ItemGroup>
	<Target Name="BuildMod" AfterTargets="Build">
		<Exec Command="dotnet $(tMLServerPath) -build $(ProjectDir) -eac $(TargetPath) -define &quot;$(DefineConstants)&quot; -unsafe $(AllowUnsafeBlocks) $(ExtraBuildModFlags)" WorkingDirectory="$(tMLSteamPath)"/>
	</Target>
</Project>