name: Monthly Update tModLoader

# Controls when the action will run. 
on:
  # This workflow runs on the first of every month at 1:23 AM UTC. The random time selection is to minimize getting delayed by similar concurrent monthly actions 
  schedule:
    - cron: '23 1 1 * *'
  # Allows you to manually run the workflow
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  MergeToStable:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
        - name: Check out repo
          uses: actions/checkout@v3
          with:
            ref: 'refs/heads/1.4-stable'
            token: ${{ secrets.TMODLOADERBOT_TOKEN }}
            persist-credentials: false
            fetch-depth: 0        
            
        - name: Merge
          run: |
            git config user.name github-actions
            git config user.email github-actions@github.com
            git reset --hard 1.4-preview
            git push --force origin 1.4-stable
            
  # This workflow contains a single job called "build"
  MergeToPreview:
    # Needs should be ensuring this doesn't run if the last job failed.
    needs: MergeToStable
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
        - name: Check out repo
          uses: actions/checkout@v3
          with:
            ref: 'refs/heads/1.4-preview'
            token: ${{ secrets.TMODLOADERBOT_TOKEN }}
            persist-credentials: false
            fetch-depth: 0        
            
        - name: Merge
          run: |
            git config user.name github-actions
            git config user.email github-actions@github.com
            git reset --hard 1.4
            git push --force origin 1.4-preview